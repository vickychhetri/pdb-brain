<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SSE Chat Streaming</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <div class="container py-4">
    <h2 class="mb-4 text-center">AI-PDB -Talk to your data !</h2>
    <div id="chat-box" class="mb-3"></div>
    <div class="input-group">
      <input type="text" id="query" class="form-control" placeholder="Type your question...">
      <button id="send" class="btn btn-primary">Send</button>
    </div>
  </div>

  <script>
    $(document).ready(function() {
      $("#send").click(function() {
        let query = $("#query").val().trim();
        if (!query) return;

        $("#chat-box").append(`<div class="message user">${query}</div><div style="clear: both;"></div>`);
        $("#query").val("");
        $("#chat-box").scrollTop($("#chat-box")[0].scrollHeight);

        let botMsg = $('<div class="message bot"></div>');
        $("#chat-box").append(botMsg).append('<div style="clear: both;"></div>');

        let source = new EventSource(`http://localhost:8000/query_stream?q=${encodeURIComponent(query)}`);

        source.onmessage = function(event) {
          if (event.data === "[[END]]") {
            source.close();
          } else {
            botMsg.append(event.data);  
            $("#chat-box").scrollTop($("#chat-box")[0].scrollHeight);
          }
        };

        source.onerror = function(err) {
          console.error("SSE error:", err);
          source.close();
        };
      });
    });
  </script>
</body>
</html>
